"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[664],{3905:function(e,n,t){t.d(n,{Zo:function(){return y},kt:function(){return s}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var d=r.createContext({}),p=function(e){var n=r.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},y=function(e){var n=p(e.components);return r.createElement(d.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,d=e.parentName,y=i(e,["components","mdxType","originalType","parentName"]),u=p(t),s=o,h=u["".concat(d,".").concat(s)]||u[s]||c[s]||a;return t?r.createElement(h,l(l({ref:n},y),{},{components:t})):r.createElement(h,l({ref:n},y))}));function s(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,l=new Array(a);l[0]=u;var i={};for(var d in n)hasOwnProperty.call(n,d)&&(i[d]=n[d]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var p=2;p<a;p++)l[p]=t[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},8420:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return d},metadata:function(){return p},toc:function(){return y},default:function(){return u}});var r=t(7462),o=t(3366),a=(t(7294),t(3905)),l=["components"],i={title:"byhand",sidebar_position:1},d=void 0,p={unversionedId:"deploy/byhand",id:"deploy/byhand",isDocsHomePage:!1,title:"byhand",description:"1. Prepare a server",source:"@site/docs/deploy/byhand.md",sourceDirName:"deploy",slug:"/deploy/byhand",permalink:"/docs/deploy/byhand",editUrl:"https://github.com/pionion/pionion.github.io.src/edit/main/website/docs/deploy/byhand.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"byhand",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"3. Load-Testing",permalink:"/docs/develop/load-testing"},next:{title:"docker",permalink:"/docs/deploy/docker"}},y=[{value:"1. Prepare a server",id:"1-prepare-a-server",children:[],level:2},{value:"2. Make sure all the module installed",id:"2-make-sure-all-the-module-installed",children:[],level:2},{value:"3. How to deploy ion with caddy",id:"3-how-to-deploy-ion-with-caddy",children:[],level:2},{value:"4. Deploy canddy",id:"4-deploy-canddy",children:[{value:"1. Prepare a real domain",id:"1-prepare-a-real-domain",children:[],level:3},{value:"2. Create a Caddyfile, replace <code>xxx.yyy</code> to your domain:",id:"2-create-a-caddyfile-replace-xxxyyy-to-your-domain",children:[],level:3},{value:"3. run canddy as a daemon:",id:"3-run-canddy-as-a-daemon",children:[],level:3},{value:"4. enjoy",id:"4-enjoy",children:[],level:3}],level:2}],c={toc:y};function u(e){var n=e.components,t=(0,o.Z)(e,l);return(0,a.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"1-prepare-a-server"},"1. Prepare a server"),(0,a.kt)("p",null,"Tips: you should make sure:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"All the ports that ion needed opened on server firewall"),(0,a.kt)("li",{parentName:"ul"},"All the ports that ion needed are mapped to your server if it's behind a NAT(This is not needed if your server has a  External Internet IP)")),(0,a.kt)("h2",{id:"2-make-sure-all-the-module-installed"},"2. Make sure all the module installed"),(0,a.kt)("p",null,'Tips: see the "quickstart" section'),(0,a.kt)("h2",{id:"3-how-to-deploy-ion-with-caddy"},"3. How to deploy ion with caddy"),(0,a.kt)("p",null,"In my scene, i deploy ion with scripts"),(0,a.kt)("p",null,"Modify the port in configs/signal.toml, change the port 5551 to 5552"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'#listen ip port\nhost = "0.0.0.0"\nport = "5552"\n')),(0,a.kt)("p",null,"Modify the port in configs/sfu.toml, change to server external ip:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'# if the sfu is deployed in a DMZ between two 1-1 NAT for internal and\n# external users.\nnat1to1 = ["xxx.xxx.xxx.xxx"]\nicelite = true\n')),(0,a.kt)("p",null,"then restart them"),(0,a.kt)("h2",{id:"4-deploy-canddy"},"4. Deploy canddy"),(0,a.kt)("h3",{id:"1-prepare-a-real-domain"},"1. Prepare a real domain"),(0,a.kt)("p",null,"config your domain dns to your server"),(0,a.kt)("h3",{id:"2-create-a-caddyfile-replace-xxxyyy-to-your-domain"},"2. Create a Caddyfile, replace ",(0,a.kt)("inlineCode",{parentName:"h3"},"xxx.yyy")," to your domain:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# redirect from www.xxx.yyy to https://xxx.yyy\n# \u8fd9\u91cc\u628awww.xxx.yyy\u91cd\u5b9a\u5411\u5230https://xxx.yyy\nwww.xxx.yyy {\n    redir https://xxx.yyy{uri}\n}\n\n# proxy for https://xxx.yyy\n# \u4ee3\u7406ion-web-app\u9875\u9762\nxxx.yyy:443 {\n    reverse_proxy localhost:8080\n}\n\n\n# proxy for wss://xxx.yyy:5551\n# \u4ee3\u7406\u4fe1\u4ee4wss://xxx.yyy:5551\nxxx.yyy:5551\n\n# i run biz on 5552, modify port in biz.toml\n# \u56e0\u4e3a5551\u88ab\u4ee3\u7406\u4f7f\u7528\uff0c\u6240\u4ee5biz\u7aef\u53e3\u63625552\n# add header for ws\nreverse_proxy localhost:5552 {\n    header_up Host {host}\n    header_up X-Real-IP {remote_host}\n    header_up X-Forwarded-For {remote_host}\n    header_up X-Forwarded-Proto {scheme}\n}\n\n# caddy log\n# caddy \u65e5\u5fd7\u914d\u7f6e\nlog {\n    output file /root/caddy/caddy.log {\n        roll_size     100MiB\n        roll_keep     3\n    }\n    level DEBUG\n}\n\n")),(0,a.kt)("h3",{id:"3-run-canddy-as-a-daemon"},"3. run canddy as a daemon:"),(0,a.kt)("p",null,"Install caddy, 2.0+ version"),(0,a.kt)("p",null,"Run caddy as a daemon:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"caddy start\n")),(0,a.kt)("p",null,"It will download a free certificate which can by used online :)"),(0,a.kt)("h3",{id:"4-enjoy"},"4. enjoy"),(0,a.kt)("p",null,"Now, you can use https://yourdomain to chat by ion-app-web"))}u.isMDXComponent=!0}}]);